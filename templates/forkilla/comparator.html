<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Comparator</title>
        <script src="https://code.jquery.com/jquery-3.1.0.min.js"></script>
        <script>
            function compare(ips){
                $("#output").html("");
                var output="";
                var parameters = new Map();
                var category = $("#category_selector").val();
                var city = $("#inputCity").val();
                var price = $("#inputPrice").val();



                if(category != ""){
                    parameters.set('category', category);
                }
                if(city != ""){
                    parameters.set('city', city);
                }
                if(price != ""){
                    parameters.set('price', price);
                }

                var dir = "";
                var j = 0;
                for (var [clave, valor] of parameters) {
                    if(j == 0){
                      dir +="?"+clave+"="+valor;
                    }else{
                         dir +="&"+clave+"="+valor;
                    }
                    j++;
                }

                for(let i=0; i<ips.length; i++){
                    $.ajax({

                        url: 'https://' + ips[i] + '/api/restaurants/'+dir,
                        type: 'GET',
                        dataType: 'json',

                        success: function (data) {
                            output+= "Requested URL: " + this.url + "<br>";
                            output += '<pre id="json">';
                            data['results'].sort(function (a,b) {
                                return parseFloat(b.price_average) - parseFloat(a.price_average);
                            });
                            output += JSON.stringify(data['results'], undefined, 2);
                            output += "</pre>";
                            $("#output").append(output+"<hr>");

                        },

                        complete: function( xhr, status ) {
                            output = "";
                        },

                        error: function( xhr, status, errorThrown ) {
                            alert( "Sorry, there was a problem!" );
                            console.log( "Error: " + errorThrown );
                            console.log( "Status: " + status );
                            console.dir( xhr );
                        },

                    });

                }

        }
        </script>
</head>
<body>

    <label for="sel2">Select a category: </label>
    <select class="form-control" id="category_selector">

            <option></option>

            <option>Rice</option>

            <option>Fusi</option>

            <option>BBQ</option>

            <option>Chin</option>

            <option>Medi</option>

            <option>Crep</option>

            <option>Hind</option>

            <option>Japa</option>

            <option>Ital</option>

            <option>Mexi</option>

            <option>Peru</option>

            <option>Russ</option>

            <option>Turk</option>

            <option>Basq</option>

            <option>Vegy</option>

            <option>Afri</option>

            <option>Egyp</option>

            <option>Grek</option>

    </select>

      <label for="inputCity">Input a City: </label>
      <input type="text" class="form-control" id="inputCity">
    <br>
      <label for="inputPrice">Input a Price: </label>
      <input type="text" class="form-control" id="inputPrice">
    <br>

   <button class="btn btn-info btn-sm" onclick="compare([sd2019-f2-forkilla.herokuapp.com,sd2019-f4-forkilla.herokuapp.com,sd2019-f8-forkilla.herokuapp.com])">Send Request! </button>

</body>
</html>